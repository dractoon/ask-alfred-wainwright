<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ask Alfred Wainwright</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: url('./img/bg.png') no-repeat center center;
      background-size: cover;
    }

    /* Answer box styling */
    #answer {
      background: rgba(255, 255, 245, 0.85);
      backdrop-filter: blur(6px);
      border: 2px solid #ccc;
      border-radius: 12px;
      padding: 1rem;
      min-height: 100px;
      color: #333;
      font-family: 'Georgia', serif;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.6s ease, transform 0.6s ease;
      position: relative;
      overflow: hidden;
      white-space: pre-wrap; /* preserves line breaks */
      word-break: normal;     /* prevents breaking words */
      max-width: 700px;       /* keeps lines readable */
    }

    /* Typewriter effect for words */
    #answer span {
      display: inline-block; /* prevents words from splitting */
      margin-right: 0.25rem; /* space between words */
      opacity: 0;
      animation: fadeInWord 0.03s forwards;
    }

    @keyframes fadeInWord {
      to { opacity: 1; }
    }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

  <img src="./img/alfred.png" 
       alt="Cartoon Alfred Wainwright"
       class="w-48 h-auto mb-2 drop-shadow-lg" />

  <h1 class="text-4xl font-bold mb-4 text-center">Ask Alfred Wainwright</h1>

  <input id="question" type="text" placeholder="Ask about a fell or walk..."
         class="p-3 w-full max-w-lg rounded border border-gray-300 mb-4 shadow"/>

  <button id="askBtn" class="bg-green-700 text-white px-5 py-2 rounded hover:bg-green-800">
    Ask Alfred
  </button>

  <div id="answerContainer" class="mt-6 w-full max-w-lg relative">
    <div id="answer"></div>
  </div>

<script>
  const answerEl = document.getElementById('answer');
  const askBtn = document.getElementById('askBtn');
  const questionInput = document.getElementById('question');

  function displayAnswer(text) {
    answerEl.innerHTML = '';
    answerEl.style.opacity = '1';
    answerEl.style.transform = 'translateY(0)';

    // Split text into paragraphs
    const paragraphs = text.split('\n\n');
    let totalDelay = 0;

    paragraphs.forEach((para, pIdx) => {
      const p = document.createElement('p');
      p.style.marginBottom = '0.75rem';

      // Split paragraph into words
      const words = para.split(' ');
      words.forEach(word => {
        const span = document.createElement('span');
        span.textContent = word;
        span.style.animationDelay = `${totalDelay}s`;
        p.appendChild(span);
        totalDelay += 0.03; // increment delay per word
      });

      answerEl.appendChild(p);
      totalDelay += 0.3; // slight pause between paragraphs
    });
  }

  async function askAlfred(question) {
    displayAnswer('Alfred is thinkingâ€¦');

    try {
      const res = await fetch('https://ask-alfred-wainwright.vercel.app/api/ask', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ question })
      });

      const data = await res.json();

      if (data.error) {
        displayAnswer(`Oops! ${data.error}`);
      } else {
        displayAnswer(data.answer);
      }
    } catch (err) {
      displayAnswer('Alfred cannot answer right now.');
      console.error(err);
    }
  }

  askBtn.addEventListener('click', () => {
    const question = questionInput.value.trim();
    if (!question) return;
    askAlfred(question);
  });

  questionInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') askBtn.click();
  });
</script>

</body>
</html>
