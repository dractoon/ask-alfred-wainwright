<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ask Alfred Wainwright</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: url('./img/mountains.jpg') no-repeat center center;
      background-size: cover;
    }

    /* Answer box styling */
    #answer {
      background: rgba(255, 255, 245, 0.85);
      backdrop-filter: blur(6px);
      border: 2px solid #ccc;
      border-radius: 12px;
      padding: 1rem;
      min-height: 100px;
      color: #333;
      font-family: 'Georgia', serif;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.6s ease, transform 0.6s ease;
      position: relative;
      overflow: hidden;
      white-space: pre-wrap; /* preserves line breaks */
    }

    /* Typewriter effect */
    .typewriter span {
      opacity: 0;
      display: inline-block;
      animation: fadeInChar 0.03s forwards;
    }

    @keyframes fadeInChar {
      to { opacity: 1; }
    }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

  <img src="./img/alfred.png" 
       alt="Cartoon Alfred Wainwright"
       class="w-48 h-auto mb-2 drop-shadow-lg" />

  <h1 class="text-4xl font-bold mb-4 text-center">Ask Alfred Wainwright</h1>

  <input id="question" type="text" placeholder="Ask about a fell or walk..."
         class="p-3 w-full max-w-lg rounded border border-gray-300 mb-4 shadow"/>

  <button id="askBtn" class="bg-green-700 text-white px-5 py-2 rounded hover:bg-green-800">
    Ask Alfred
  </button>

  <div id="answerContainer" class="mt-6 w-full max-w-lg relative">
    <div id="answer" class="typewriter"></div>
  </div>

<script>
  const answerEl = document.getElementById('answer');
  const askBtn = document.getElementById('askBtn');
  const questionInput = document.getElementById('question');

  function displayAnswer(text) {
    answerEl.innerHTML = '';
    answerEl.style.opacity = '1';
    answerEl.style.transform = 'translateY(0)';

    for (let i = 0; i < text.length; i++) {
      const char = text[i];
      const span = document.createElement('span');
      span.textContent = char === ' ' ? '\u00A0' : char;
      span.style.animation = `fadeInChar 0.03s forwards`;
      span.style.animationDelay = `${i * 0.03}s`;
      answerEl.appendChild(span);
    }
  }

  async function askAlfred(question) {
    displayAnswer('Alfred is thinkingâ€¦');

    try {
      const res = await fetch('/api/ask', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ question })
      });

      const data = await res.json();

      if (data.error) {
        displayAnswer(`Oops! ${data.error}`);
      } else {
        displayAnswer(data.answer);
      }
    } catch (err) {
      displayAnswer('Alfred cannot answer right now.');
      console.error(err);
    }
  }

  askBtn.addEventListener('click', () => {
    const question = questionInput.value.trim();
    if (!question) return;
    askAlfred(question);
  });

  questionInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') askBtn.click();
  });
</script>


</body>
</html>
